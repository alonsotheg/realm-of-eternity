{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://realmofeternity.com/schemas/quest.schema.json",
  "title": "Quest",
  "description": "Schema for quest definitions",
  "type": "object",
  "required": ["id", "name", "difficulty", "stages"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_]*$",
      "description": "Unique quest identifier"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100
    },
    "description": {
      "type": "string",
      "maxLength": 1000
    },
    "difficulty": {
      "type": "string",
      "enum": ["novice", "intermediate", "experienced", "master", "grandmaster"]
    },
    "length": {
      "type": "string",
      "enum": ["very_short", "short", "medium", "long", "very_long"]
    },
    "quest_points": {
      "type": "integer",
      "minimum": 1,
      "maximum": 10
    },
    "members_only": {
      "type": "boolean",
      "default": true
    },
    "series": {
      "type": "string",
      "description": "Quest series this belongs to"
    },
    "requirements": {
      "type": "object",
      "properties": {
        "skills": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 1,
            "maximum": 120
          }
        },
        "quests": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "item_id": { "type": "string" },
              "quantity": { "type": "integer", "minimum": 1 }
            }
          }
        },
        "combat_level": {
          "type": "integer",
          "minimum": 3
        }
      }
    },
    "start": {
      "type": "object",
      "properties": {
        "npc": { "type": "string" },
        "location": { "type": "string" },
        "item": { "type": "string" }
      }
    },
    "stages": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/questStage"
      }
    },
    "rewards": {
      "$ref": "#/$defs/questRewards"
    }
  },
  "$defs": {
    "questStage": {
      "type": "object",
      "required": ["id", "description"],
      "properties": {
        "id": {
          "type": "integer",
          "minimum": 0
        },
        "description": {
          "type": "string"
        },
        "objectives": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["talk", "kill", "collect", "use_item", "travel", "craft", "skill_check"]
              },
              "target": { "type": "string" },
              "quantity": { "type": "integer", "minimum": 1 },
              "location": { "type": "string" }
            }
          }
        },
        "dialogue": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "speaker": { "type": "string" },
              "text": { "type": "string" }
            }
          }
        },
        "cutscene": {
          "type": "string"
        }
      }
    },
    "questRewards": {
      "type": "object",
      "properties": {
        "experience": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "item_id": { "type": "string" },
              "quantity": { "type": "integer", "minimum": 1 }
            }
          }
        },
        "gold": {
          "type": "integer",
          "minimum": 0
        },
        "unlocks": {
          "type": "array",
          "items": { "type": "string" }
        },
        "lamp_xp": {
          "type": "object",
          "properties": {
            "amount": { "type": "integer" },
            "skills": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    }
  }
}
